'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var parser = require('@babel/parser');
var traverse = _interopDefault(require('@babel/traverse'));
var get = _interopDefault(require('lodash/get'));

const fromDeclarations = (declarations = []) => Array.isArray(declarations) && declarations.length > 0 ? declarations.map(declaration => get(declaration, 'id.name')) : [];

const traverseOnExports = fn => node => {
  try {
    const ast = parser.parse(node.value, {
      sourceType: 'module'
    });
    let populated = [];
    traverse(ast, {
      enter(path) {
        if (path.isExportDeclaration()) {
          populated = populated.concat(fn(path));
          return;
        }
      }

    });
    return populated;
  } catch (err) {
    return [];
  }
};

const getExportsVariables = traverseOnExports(path => {
  const type = get(path, 'node.declaration.type');

  switch (type) {
    case 'VariableDeclaration':
      return fromDeclarations(get(path, 'node.declaration.declarations', []));

    case 'FunctionDeclaration':
      const declaration = get(path, 'node.declaration', false);
      return fromDeclarations(declaration ? [declaration] : []);

    case 'Identifier':
      return get(path, 'node.declaration.name');

    default:
      console.error(`Unexpected export type ${type} in docz-utils/exports`);
  }
});

exports.getExportsVariables = getExportsVariables;
